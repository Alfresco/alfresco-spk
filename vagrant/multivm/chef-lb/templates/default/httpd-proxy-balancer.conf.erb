LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule proxy_balancer_module modules/mod_proxy_balancer.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule proxy_http_module modules/mod_proxy_http.so

<% node['lb']['balancers'].each do |balancerName,balancer| %>
  
  # Reverse Proxy Settings (cluster load balancing)
  ProxyRequests Off
  ProxyPass /<%= balancerName %> balancer://<%= balancerName %>cluster/ stickysession=JSESSIONID
  ProxyPassReverse /<%= balancerName %> balancer://<%= balancerName %>cluster/

  <Proxy balancer://<%= balancerName %>cluster>
    <% balancer.each do |n| %>
      BalancerMember http://<%= n['ipaddress'] %>:8080/<%= balancerName %> route=<%=n['route'] %>
    <% end %>
  </Proxy>

<% end %>